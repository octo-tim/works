{% extends "base.html" %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">ëŒ€ì‹œë³´ë“œ</h2>
    <div class="flex space-x-2">
        <!-- Add Task Modal Trigger -->
        <button onclick="document.getElementById('taskModal').classList.remove('hidden')"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow-sm text-sm font-medium">
            + ìƒˆ ì—…ë¬´
        </button>
    </div>
</div>

<!-- Goals Section -->
<div class="mb-6 space-y-4">
    <!-- Annual Goal -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl shadow-lg p-6 text-white">
        <h2 class="text-xl font-bold mb-2">2026 ì „ì‚¬ ëª©í‘œ</h2>
        <form action="/goals/annual" method="post" class="flex gap-2">
            <input type="hidden" name="year" value="2026">
            <input type="text" name="content" value="{{ goals.annual_2026.content if goals.annual_2026 else '' }}"
                class="flex-1 bg-white/10 border border-white/20 rounded px-3 py-2 text-white placeholder-blue-200 outline-none focus:bg-white/20 transition"
                placeholder="2026ë…„ ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onblur="this.form.submit()">
        </form>
    </div>

    <!-- Monthly Goals Summary (Selected Month) -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-bold text-gray-800">ì›”ë³„ ëª©í‘œ í˜„í™©</h3>
            <!-- Month Selector -->
            <form action="/" method="get">
                <select name="target_month" onchange="this.form.submit()"
                    class="border-none bg-gray-100 rounded-lg px-3 py-1 text-sm font-bold text-gray-700 cursor-pointer focus:ring-0">
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if selected_month==m %}selected{% endif %}>{{ m }}ì›”</option>
                    {% endfor %}
                </select>
            </form>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- System Division -->
            <div class="bg-blue-50 rounded-lg p-4 border border-blue-100 flex flex-col gap-3">
                <h4 class="text-xs font-bold text-blue-600 mb-1 border-b border-blue-200 pb-1">ì‹œìŠ¤í…œì‚¬ì—…ë¶€</h4>
                <div>
                    <span class="text-xs text-gray-500 block">ì—…ë¬´ëª©í‘œ</span>
                    <p class="text-gray-800 font-medium text-sm">
                        {{ goals.monthly_obj_system.content if goals.monthly_obj_system else '-' }}
                    </p>
                </div>
                <div class="flex gap-4">
                    <div>
                        <span class="text-xs text-gray-500 block">ë§¤ì¶œëª©í‘œ</span>
                        <p class="text-gray-800 font-bold text-sm">
                            {{ goals.monthly_perf_system.goal_value if goals.monthly_perf_system else '-' }}
                        </p>
                    </div>
                    <div>
                        <span class="text-xs text-gray-500 block">ì‹¤ì </span>
                        <p class="text-gray-800 font-bold text-sm">
                            {{ goals.monthly_perf_system.actual_value if goals.monthly_perf_system else '-' }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Distribution Division -->
            <div class="bg-pink-50 rounded-lg p-4 border border-pink-100 flex flex-col gap-3">
                <h4 class="text-xs font-bold text-pink-600 mb-1 border-b border-pink-200 pb-1">ìœ í†µì‚¬ì—…ë¶€</h4>
                <div>
                    <span class="text-xs text-gray-500 block">ì—…ë¬´ëª©í‘œ</span>
                    <p class="text-gray-800 font-medium text-sm">
                        {{ goals.monthly_obj_dist.content if goals.monthly_obj_dist else '-' }}
                    </p>
                </div>
                <div class="flex gap-4">
                    <div>
                        <span class="text-xs text-gray-500 block">ë§¤ì¶œëª©í‘œ</span>
                        <p class="text-gray-800 font-bold text-sm">
                            {{ goals.monthly_perf_dist.goal_value if goals.monthly_perf_dist else '-' }}
                        </p>
                    </div>
                    <div>
                        <span class="text-xs text-gray-500 block">ì‹¤ì </span>
                        <p class="text-gray-800 font-bold text-sm">
                            {{ goals.monthly_perf_dist.actual_value if goals.monthly_perf_dist else '-' }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Dashboard Content: Today's Check, Today's Schedule & In-Progress Tasks -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-full pb-10">

    <!-- Today's Check -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden">
        <div
            class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-orange-50 to-white flex justify-between items-center">
            <h3 class="font-bold text-gray-800 flex items-center gap-2">
                <span class="text-orange-500">âœ¨</span> Today's Check
            </h3>
        </div>
        <div class="flex-1 flex flex-col p-4">
            <!-- Message List -->
            <div class="flex-1 overflow-y-auto space-y-3 mb-4 max-h-[300px]">
                {% if todays_checks %}
                {% for check in todays_checks %}
                <div
                    class="p-3 rounded-lg border {{ 'bg-blue-50 border-blue-100' if check.sender_id == user.id else 'bg-green-50 border-green-100' }}">
                    <div class="flex justify-between items-start mb-1">
                        <span
                            class="text-xs font-bold {{ 'text-blue-600' if check.sender_id == user.id else 'text-green-600' }}">
                            {% if check.sender_id == user.id %}
                            To: {{ check.receiver.username }}
                            {% else %}
                            From: {{ check.sender.username }}
                            {% endif %}
                        </span>
                        <span class="text-xs text-gray-400">{{ check.created_at.strftime('%H:%M') }}</span>
                    </div>
                    <p class="text-sm text-gray-800">{{ check.content }}</p>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-center text-gray-400 text-sm mt-10">ì˜¤ëŠ˜ ì£¼ê³ ë°›ì€ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endif %}
            </div>

            <!-- Input Form -->
            <form action="/todays_check/create" method="post" class="mt-auto border-t pt-4">
                <div class="mb-2">
                    <select name="receiver_id" required
                        class="w-full text-sm border rounded px-2 py-1.5 focus:ring-2 focus:ring-orange-500 outline-none">
                        <option value="">ë°›ëŠ” ì‚¬ëŒ ì„ íƒ</option>
                        {% for u in users %}
                        {% if u.id != user.id %}
                        <option value="{{ u.id }}">{{ u.username }} ({{ u.department }})</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <textarea name="content" required rows="3" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    class="w-full text-sm border rounded px-3 py-2 focus:ring-2 focus:ring-orange-500 outline-none resize-none mb-2"></textarea>
                <button type="submit"
                    class="w-full bg-orange-500 hover:bg-orange-600 text-white text-sm font-bold py-2 rounded transition">
                    ë³´ë‚´ê¸°
                </button>
            </form>
        </div>
    </div>

    <!-- Left Column: Today's Schedule -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden">
        <div
            class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-white flex justify-between items-center">
            <h3 class="font-bold text-gray-800 flex items-center gap-2">
                <span class="text-blue-500">ğŸ“…</span> ì˜¤ëŠ˜ì˜ ì¼ì •
            </h3>
            <a href="/calendar" class="text-xs text-blue-600 hover:text-blue-800 font-medium">ì „ì²´ë³´ê¸° &rarr;</a>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            {% if todays_events %}
            {% for event in todays_events %}
            <div
                class="flex items-start gap-4 p-3 rounded-lg hover:bg-gray-50 transition border border-transparent hover:border-gray-100 group">
                <div class="min-w-[4.5rem] text-center">
                    {% if event.is_all_day %}
                    <span
                        class="inline-block px-2 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded">ì¢…ì¼</span>
                    {% else %}
                    <p class="text-gray-900 font-bold">{{ event.start_time }}</p>
                    <p class="text-gray-400 text-xs">{{ event.end_time }}</p>
                    {% endif %}
                </div>
                <div class="flex-1">
                    <h4 class="font-bold text-gray-800 group-hover:text-blue-600 transition">{{ event.title }}</h4>
                    {% if event.description %}
                    <p class="text-sm text-gray-500 line-clamp-1">{{ event.description }}</p>
                    {% endif %}
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded">{{ event.user_name
                            }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="h-full flex flex-col items-center justify-center text-gray-400">
                <p class="mb-2 text-2xl">â˜•ï¸</p>
                <p>ì˜¤ëŠ˜ ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Right Column: In-Progress Tasks -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-full overflow-hidden">
        <div
            class="px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-green-50 to-white flex justify-between items-center">
            <h3 class="font-bold text-gray-800 flex items-center gap-2">
                <span class="text-green-500">ğŸš€</span> ì§„í–‰ ì¤‘ ì—…ë¬´
            </h3>
            <a href="/tasks" class="text-xs text-green-600 hover:text-green-800 font-medium">ì „ì²´ë³´ê¸° &rarr;</a>
        </div>
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            {% if tasks_inprogress %}
            {% for task in tasks_inprogress %}
            {% include 'task_card.html' %}
            {% endfor %}
            {% else %}
            <div class="h-full flex flex-col items-center justify-center text-gray-400">
                <p class="mb-2 text-2xl">âœ¨</p>
                <p>ì§„í–‰ ì¤‘ì¸ ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            {% endif %}
        </div>
    </div>

</div>

<!-- Calendar Section -->
<div class="mt-8 bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-10">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-800">ì¼ì • ìº˜ë¦°ë”</h3>
    </div>
    <div id='calendar' class="h-[600px]"></div>
</div>

<!-- Create Task Modal -->
<div id="taskModal"
    class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center backdrop-blur-sm z-50">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800">ìƒˆ ì—…ë¬´ ë§Œë“¤ê¸°</h3>
            <button onclick="document.getElementById('taskModal').classList.add('hidden')"
                class="text-gray-400 hover:text-gray-600">âœ•</button>
        </div>
        <form action="/tasks" method="post" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ì—…ë¬´ëª…</label>
                <input type="text" name="title" required
                    class="w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                <textarea name="description" rows="2"
                    class="w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìƒíƒœ</label>
                    <select name="status" class="w-full border rounded-lg px-3 py-2 text-sm">
                        <option value="Todo">ì˜ˆì •</option>
                        <option value="In Progress">ì§„í–‰ ì¤‘</option>
                        <option value="Done">ì¢…ë£Œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ì¼</label>
                    <input type="date" name="start_date" class="w-full border rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë§ˆê°ì¼</label>
                    <input type="date" name="due_date" class="w-full border rounded-lg px-3 py-2 text-sm">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ë‹´ë‹¹ì (ë‹¤ì¤‘ ì„ íƒ: Ctrl/Cmd + Click)</label>
                <select name="assignee_ids" id="create_assignee_ids" multiple
                    class="w-full border rounded-lg px-3 py-2 text-sm h-24">
                    {% for u in users %}
                    <option value="{{ u.id }}" data-department="{{ u.department }}">{{ u.username }} ({{
                        u.department }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ì—…ë¶€ (ì„ íƒì‹œ ë‹´ë‹¹ì í•„í„°ë§)</label>
                <select name="department" id="create_department" class="w-full border rounded-lg px-3 py-2 text-sm"
                    onchange="filterAssignees('create_department', 'create_assignee_ids')">
                    <option value="">ì „ì²´ (ë¯¸ì§€ì •)</option>
                    <option value="ì‹œìŠ¤í…œì‚¬ì—…ë¶€">ì‹œìŠ¤í…œì‚¬ì—…ë¶€</option>
                    <option value="ìœ í†µì‚¬ì—…ë¶€">ìœ í†µì‚¬ì—…ë¶€</option>
                    <option value="ê²½ì˜ì§€ì›íŒ€">ê²½ì˜ì§€ì›íŒ€</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">í”„ë¡œì íŠ¸</label>
                <select name="project_id" class="w-full border rounded-lg px-3 py-2 text-sm">
                    <option value="0">Inbox (í”„ë¡œì íŠ¸ ì—†ìŒ)</option>
                    {% for p in projects %}
                    <option value="{{ p.id }}">{{ p.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit"
                class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition">ìƒì„±</button>
        </form>
    </div>
</div>

<!-- Edit Task Modal -->
<div id="editTaskModal"
    class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center backdrop-blur-sm z-50">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-800">ì—…ë¬´ ìˆ˜ì •</h3>
            <button onclick="document.getElementById('editTaskModal').classList.add('hidden')"
                class="text-gray-400 hover:text-gray-600">âœ•</button>
        </div>
        <form id="editTaskForm" method="post" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ì—…ë¬´ëª…</label>
                <input type="text" name="title" id="edit_title" required
                    class="w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ì„¤ëª…</label>
                <textarea name="description" id="edit_description" rows="2"
                    class="w-full border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ìƒíƒœ</label>
                    <select name="status" id="edit_status" class="w-full border rounded-lg px-3 py-2 text-sm">
                        <option value="Todo">ì˜ˆì •</option>
                        <option value="In Progress">ì§„í–‰ ì¤‘</option>
                        <option value="Done">ì¢…ë£Œ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ì¼</label>
                    <input type="date" name="start_date" id="edit_start_date"
                        class="w-full border rounded-lg px-3 py-2 text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë§ˆê°ì¼</label>
                    <input type="date" name="due_date" id="edit_due_date"
                        class="w-full border rounded-lg px-3 py-2 text-sm">
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì‚¬ì—…ë¶€</label>
                    <select name="department" id="edit_department" class="w-full border rounded-lg px-3 py-2 text-sm"
                        onchange="filterAssignees('edit_department', 'edit_assignee_ids')">
                        <option value="">ë¯¸ì§€ì • (ì „ì²´)</option>
                        <option value="ì‹œìŠ¤í…œì‚¬ì—…ë¶€">ì‹œìŠ¤í…œì‚¬ì—…ë¶€</option>
                        <option value="ìœ í†µì‚¬ì—…ë¶€">ìœ í†µì‚¬ì—…ë¶€</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ë‹´ë‹¹ì (ë‹¤ì¤‘ ì„ íƒ)</label>
                    <select name="assignee_ids" id="edit_assignee_ids" multiple
                        class="w-full border rounded-lg px-3 py-2 text-sm h-24">
                        {% for u in users %}
                        <option value="{{ u.id }}" data-department="{{ u.department }}">{{ u.username }} ({{
                            u.department }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">í”„ë¡œì íŠ¸</label>
                <select name="project_id" id="edit_project_id" class="w-full border rounded-lg px-3 py-2 text-sm">
                    <option value="0">Inbox (í”„ë¡œì íŠ¸ ì—†ìŒ)</option>
                    {% for p in projects %}
                    <option value="{{ p.id }}">{{ p.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="flex gap-2">
                <button type="button" onclick="deleteTask()"
                    class="w-1/3 bg-red-100 text-red-600 font-bold py-2 rounded-lg hover:bg-red-200 transition">ì‚­ì œ</button>
                <button type="submit"
                    class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 transition">ì €ì¥</button>
            </div>
        </form>

        <!-- Delete Form (Hidden) -->
        <form id="deleteTaskForm" method="post" class="hidden"></form>

        <!-- Divider -->
        <hr class="my-6 border-gray-200">

        <!-- File Upload Section -->
        <div>
            <h4 class="font-bold text-gray-800 mb-2">ì²¨ë¶€ íŒŒì¼</h4>
            <ul id="taskFileList" class="mb-4 space-y-2 text-sm text-gray-600">
                <!-- Dynamically populated -->
            </ul>

            <form id="taskUploadForm" method="post" enctype="multipart/form-data" class="flex gap-2">
                <input type="file" name="file" required
                    class="flex-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                <button type="submit"
                    class="bg-gray-800 text-white text-xs px-3 py-2 rounded hover:bg-gray-700">ì—…ë¡œë“œ</button>
            </form>
        </div>
    </div>
</div>

<script>
    // Department Filtering Logic
    function filterAssignees(deptSelectId, assigneeSelectId) {
        const deptSelect = document.getElementById(deptSelectId);
        const assigneeSelect = document.getElementById(assigneeSelectId);
        const selectedDept = deptSelect.value;

        // Preserve selection if possible? No, filtering usually clears invalid selections or hides them.
        // For simplicity, we show/hide options.
        // NOTE: hidden attribute on option is not supported in some browsers, but display:none usually works or re-building options.
        // Let's use display style toggle.

        Array.from(assigneeSelect.options).forEach(option => {
            const userDept = option.getAttribute('data-department');
            if (selectedDept === "" || userDept === selectedDept) {
                option.style.display = "";
                option.disabled = false;
            } else {
                option.style.display = "none";
                option.disabled = true; // Also disable to be sure
                option.selected = false; // Deselect if hidden
            }
        });
    }

    function openEditModal(id, title, description, status, department, assignee_ids, start_date, due_date, project_id, filenames, filepaths) {
        document.getElementById('edit_title').value = title;
        document.getElementById('edit_description').value = description;
        document.getElementById('edit_status').value = status;
        document.getElementById('edit_department').value = department || "";


        // Handle Multiple Select
        const select = document.getElementById('edit_assignee_ids');
        // Reset
        Array.from(select.options).forEach(o => o.selected = false);
        // Select matching
        if (assignee_ids) {
            Array.from(select.options).forEach(option => {
                option.selected = assignee_ids.includes(parseInt(option.value));
            });
        }

        document.getElementById('edit_start_date').value = start_date;
        document.getElementById('edit_due_date').value = due_date;
        document.getElementById('edit_project_id').value = project_id;

        document.getElementById('editTaskForm').action = "/tasks/" + id + "/update";
        document.getElementById('taskUploadForm').action = "/tasks/" + id + "/upload";
        document.getElementById('deleteTaskForm').action = "/tasks/" + id + "/delete";

        // Populate File List
        const fileList = document.getElementById('taskFileList');
        fileList.innerHTML = '';

        if (filenames && filenames.length > 0) {
            filenames.forEach((name, index) => {
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = filepaths[index]; // Use filepath
                link.textContent = name;
                link.target = "_blank";
                link.className = "text-blue-600 hover:underline flex items-center";
                link.innerHTML = `<span class="mr-2">ğŸ“„</span> ${name}`;
                li.appendChild(link);
                fileList.appendChild(li);
            });
        } else {
            fileList.innerHTML = '<li class="text-gray-400 italic">ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        }

        document.getElementById('editTaskModal').classList.remove('hidden');
    }

    function deleteTask() {
        if (confirm('ì •ë§ ì´ ì—…ë¬´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            document.getElementById('deleteTaskForm').submit();
        }
    }
</script>
<!-- FullCalendar CDN -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko', // Korean locale
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,dayGridWeek,listWeek'
            },
            events: {{ calendar_events | tojson }},
        eventClick: function (info) {
            if (info.event.url && info.event.url.startsWith("javascript:")) {
                info.jsEvent.preventDefault(); // Prevent navigating to "javascript:..."
                eval(info.event.url); // Execute the JS
            }
        },
        eventTimeFormat: {
        hour: '2-digit',
        minute: '2-digit',
        meridiem: false
    }
        });
    calendar.render();
    });
</script>
{% endblock %}